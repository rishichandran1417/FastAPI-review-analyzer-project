<!DOCTYPE html>
<html>
<head>
  <title>Customer Reviews - Amazon Review Analysis</title>
  <link rel="stylesheet" href="/static/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div class="container">
    <header>
      <h1>Customer Reviews</h1>
    </header>

    <nav class="nav-bar">
      <a href="/" class="nav-btn">
        <span class="nav-icon">Home</span>
      </a>
      <a href="/products" class="nav-btn">
        <span class="nav-icon">Products</span>
      </a>
      <a href="/reviews" class="nav-btn active">
        <span class="nav-icon">Reviews</span>
      </a>
      <a href="/dashboard" class="nav-btn">
        <span class="nav-icon">Dashboard</span>
      </a>
      <a href="/clear" class="nav-btn clear-btn">
        <span class="nav-icon">Clear Data</span>
      </a>
    </nav>

    <div class="main-content">
      {% if reviews %}
        <div class="animated-reviews">
        {% for r in reviews %}
          <div class="card">
            <h3>{{ r.product_name or "Unknown Product" }}</h3>
            <h4>{{ r.review_title or "Customer Review" }}</h4>
            
            {% set review_text = r.review_text or "Review content not available" %}
            {% if review_text|length > 30 and not review_text.startswith('sp:') and not review_text.startswith('window.') %}
              <p class="review-text">{{ review_text }}</p>
            {% else %}
              <p class="review-placeholder">This review content appears to contain technical website code rather than actual customer feedback. This can happen when Amazon updates their page structure. The sentiment analysis was still performed on the available text.</p>
              {% if review_text|length < 200 %}
                <details class="technical-content">
                  <summary>View raw extracted text</summary>
                  <code style="font-size: 0.8em; color: var(--text-muted);">{{ review_text }}</code>
                </details>
              {% endif %}
            {% endif %}
            
            <div class="review-meta">
              <div class="meta-item">
                <strong>Rating:</strong> 
                {% for i in range(1, 6) %}
                  {% if i <= (r.rating or 0) %}
                    <span style="color: #fdd663;">★</span>
                  {% else %}
                    <span style="color: var(--text-muted);">☆</span>
                  {% endif %}
                {% endfor %}
                ({{ r.rating or 0 }}/5)
              </div>
              <div class="meta-item">
                <strong>Sentiment:</strong> 
                <span class="sentiment-{{ (r.sentiment or 'neutral')|lower }}">
                  {% if r.sentiment == 'positive' %}
                    Positive
                  {% elif r.sentiment == 'negative' %}
                    Negative
                  {% else %}
                    Neutral
                  {% endif %}
                </span>
              </div>
              <div class="meta-item">
                <strong>Confidence:</strong> 
                {% set polarity = r.polarity or 0 %}
                {% if polarity > 0.1 %}
                  <span style="color: var(--accent-color);">{{ "%.0f"|format(polarity * 100) }}%</span>
                {% elif polarity < -0.1 %}
                  <span style="color: #f28b82;">{{ "%.0f"|format(polarity * -100) }}%</span>
                {% else %}
                  <span style="color: var(--text-secondary);">{{ "%.0f"|format((polarity if polarity >= 0 else -polarity) * 100) }}%</span>
                {% endif %}
              </div>
              <div class="meta-item">
                <strong>Added:</strong> 
                {{ r.created_at.split('.')[0] if r.created_at else 'Unknown' }}
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          <h2>No Reviews Found</h2>
          <p>Start by analyzing an Amazon product to see detailed customer reviews here.</p>
          <a href="/" class="btn-primary">Analyze Product</a>
        </div>
      {% endif %}
    </div>
  </div>
</body>
</html>
